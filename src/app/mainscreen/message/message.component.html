<div class='message-container' [ngClass]="{'inverted': isOwnMessage}" *ngIf="_message" (mouseleave)="closeToolbar()"
    (mouseenter)="openToolbar()">
    <app-toolbar *ngIf="showToolbar" [isOwnMessage]="isOwnMessage" [message]="_message"
        [messageLocation]="messageLocation" (emojiSelectedOutput)="handleEmojiSelection($event)"
        (editMessageOutput)="handleMessageEdit($event)">
    </app-toolbar>
    <img src="{{ autorAvatar }}" class="message-img" *ngIf="autorAvatar">
    <div class="message-content" tabindex="0">
        <div class="message-head">
            <div *ngIf="autorName!=''"><b class="message-username" (click)="openUserProfil()">{{ autorName }}</b></div>
            <div class="message-timestamp"> {{ getTimestamp(_message.timestamp) }} Uhr</div>
        </div>

        <mat-card *ngIf="!editMessage">
            <mat-card-content>
              {{ _message.content }}
              <ng-container *ngIf="_message.fileSrc">
                <ng-container *ngIf="isPDF(_message.fileName); else normalPath">
                  <div class="pdf-box">
                    <a [href]="_message.fileSrc" download="{{ _message.fileName }}" target="_blank">
                      <img [src]="'assets/img/icons/pdf-icon2.svg'" alt="{{ _message.fileName }}" style="max-width: 100%; max-height: 40px;">
                      {{ _message.fileName }}
                    </a>
                  </div>
                </ng-container>
                <ng-template #normalPath>
                  <a [href]="_message.fileSrc" download="{{ _message.fileName }}" target="_blank">
                    <img [src]="_message.fileSrc" alt="{{ _message.fileName }}" class="img-box">
                  </a>
                </ng-template>
              </ng-container>
            </mat-card-content>
        </mat-card>

        <app-addreaction *ngIf="showMessageReactions && !editMessage" [isOpened]="showMessageReactions"
            (emojiSelectedOutput)="handleEmojiSelection($event)">
        </app-addreaction>

        <app-message-edit 
            *ngIf="editMessage" 
            [message]="_message" 
            (showEditMessageOutput)="handleMessageEdit($event)">
        </app-message-edit>

        <div class='message-footer'>
            <div class="answers-link"
                *ngIf="this.messageService.loadedAnswers.length > 0 && messageLocation == 'channel'"
                (click)="threadFirebaseService.openThread(_message)">
                {{ this.messageService.loadedAnswers.length }} Antworten
            </div>

            <div *ngFor="let reaction of messageService.loadedReactions" class="reaction-smileys">
                <div class="emoji-container">
                    <app-reaction [reaction]="reaction"
                        (emojiSelectedOutput)="handleEmojiSelection($event)"></app-reaction>
                </div>
            </div>
            <img src="assets/img/icons/addreactionplus.svg" (click)="toggleReactions($event)">
        </div>
    </div>

</div>